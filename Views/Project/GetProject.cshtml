@model ProjectIndexViewModel

@using Microsoft.AspNetCore.Identity
@inject UserManager<User> _userManager

@{
    var currentUserId = _userManager.GetUserId(User);
}

<a asp-action="CreateProject" class="btn btn-primary mb-3">Create new Project</a>
@* ändra så att under my projects kommer mina ägna projekt först och därefter projekt som jag deltar i *@
<h3>My projects</h3>
@if (Model.MyProjects.Any())
{
    @foreach(var project in Model.MyProjects)
    {
        var relation = project.ProjectUsers.First(pu => pu.UserId == currentUserId);@* ------ändring------ *@
        <div class="min-vh-80 read-banner">
            <div class="row">
                <div class="col-12">
                    <p><strong>Title : </strong>@project.Title</p>
                </div>
                <div class="col-12">
                    <p><strong>Project description : </strong>@project.Description</p>
                </div>
                <div class="col-12">
                    <p><strong>Project started : </strong>@project.StartDate.ToShortDateString()</p>
                </div>
                <div class="col-7">
                    @if (project.Enddate == null)
                    {
                        <p><strong>Project status : </strong>Ongoing project</p>
                    }
                    else
                    {
                        <p><strong>Project ended : </strong>@project.Enddate?.ToString("yyyy-mm-dd")</p>
                    }
                </div>
                @* ------ändring------ *@
                @if (relation.IsOwner)
                {
                    <div class="col-5 d-flex justify-content-end align-items-end">
                        <a asp-action="UpdateProject" asp-route-id="@project.Pid" class="btn btn-primary"><i class="fa-solid fa-pencil"></i>Update a project</a>
                    </div>
                }
                else
                {
                    <div class="col-5 d-flex justify-content-end align-items-end">
                        <button class="btn btn-info">Participant</button>
                    </div>
                }
            </div>
        </div>
    }
}
else
{
    <p>You don´t own any projects.</p>
}

<h3>Other projects</h3>

@if (Model.OtherProjects.Any())
{
    @foreach(var project in Model.OtherProjects)
    {
        var isUserInProject = project.ProjectUsers.Any(pu => pu.UserId == currentUserId);
        var owner = project.ProjectUsers.FirstOrDefault(pu => pu.IsOwner);
        
        <div class="min-vh-80 read-banner">

            <div class="row">
                @if (owner != null)
                {
                    <div class="col-12">
                        <p><strong>Owner : </strong>@owner.User.FirstName @owner.User.LastName</p>
                    </div>
                }
                <div class="col-12">
                    <p><strong>Title : </strong>@project.Title</p>
                </div>

                <div class="col-12">
                    <p><strong>Project description : </strong>@project.Description</p>
                </div>

                <div class="col-12">
                    <p><strong>Project started : </strong>@project.StartDate.ToShortDateString()</p>
                </div>

                <p><strong>Published : </strong>@project.PublisDate.ToShortDateString()</p>
                @if (!isUserInProject)
                {
                    <form method="post" asp-controller="Project" asp-action="ProjectDetails" asp-route-PUId="@owner!.PUId">
                        <div class="col-5 d-flex justify-content-end align-items-end">
                            <button class="btn btn-primary">Join project!</button>
                        </div>
                    </form>
                }
                else
                {
                    <div class="col-5 d-flex justify-content-end align-items-end">
                        <button class="btn btn-info">Already joined</button>
                    </div>
                }
            </div>
        </div>
    }
}
else
{
    <p>No other projects available.</p>
}


@* <h3>Other projects</h3>

@if (Model.OtherProjects.Any())
{
    <div class="row g-4">
        @foreach (var project in Model.OtherProjects)
        {

            var isUserInProject = project.ProjectUsers.Any(pu => pu.UserId == currentUserId);
            var owner = project.ProjectUsers.FirstOrDefault(pu => pu.IsOwner);

            <div class="col-12 col-md-6 col-lg-4">

                <div class="card h-100 shadow-sm border-0">

                    <div class="card-header bg-light border-0">
                        <h5 class="mb-0 fw-semibold">@project.Title</h5>
                        @if (owner != null)
                        {
                            <small class="text-muted">@owner.User.FirstName @owner.User.LastName</small>
                        }
                    </div>

                    <div class="card-body d-flex flex-column">
                        <p class="text-muted mb-2">@project.Description</p>

                        <ul class="list-unstyled small mb-4">
                            <li>
                                <strong>Started:</strong>
                                @project.StartDate.ToShortDateString();
                            </li>
                            <li>
                                <strong>Published:</strong>
                                @project.PublisDate.ToShortDateString();
                            </li>
                        </ul>
                        <div class="mt-auto text-end">
                            @if (!isUserInProject)
                            {
                                <form method="post" asp-controller="Project" asp-action="ProjectDetails" asp-route-PUId="@owner!.PUId">
                                    <button class="btn btn-primary btn-sm"><i class="fa-solid fa-user-plus me-1"></i>Join project!</button>
                                </form>
                            }
                            else
                            {
                                <button class="btn btn-outline-secondary btn-sm" disabled><i class="fa-solid fa-check me-1"></i>Already joined</button>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info">
        No other projects available.
    </div>
} *@
        
    
    
